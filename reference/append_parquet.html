<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Append a data frame to an existing Parquet file — append_parquet • nanoparquet</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Append a data frame to an existing Parquet file — append_parquet"><meta name="description" content="The schema of the data frame must be compatible with the schema of
the file."><meta property="og:description" content="The schema of the data frame must be compatible with the schema of
the file."><script defer data-domain="nanoparquet.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nanoparquet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/benchmarks.html">Benchmarks</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/nanoparquet/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Append a data frame to an existing Parquet file</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/nanoparquet/blob/master/R/write-parquet.R" class="external-link"><code>R/write-parquet.R</code></a></small>
      <div class="d-none name"><code>append_parquet.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The schema of the data frame must be compatible with the schema of
the file.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">append_parquet</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">file</span>,</span>
<span>  compression <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"snappy"</span>, <span class="st">"gzip"</span>, <span class="st">"zstd"</span>, <span class="st">"uncompressed"</span><span class="op">)</span>,</span>
<span>  encoding <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  row_groups <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  options <span class="op">=</span> <span class="fu"><a href="parquet_options.html">parquet_options</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Data frame to append.</p></dd>


<dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>Path to the output file.</p></dd>


<dt id="arg-compression">compression<a class="anchor" aria-label="anchor" href="#arg-compression"></a></dt>
<dd><p>Compression algorithm to use for the newly written
data. See <code><a href="write_parquet.html">write_parquet()</a></code>.</p></dd>


<dt id="arg-encoding">encoding<a class="anchor" aria-label="anchor" href="#arg-encoding"></a></dt>
<dd><p>Encoding to use for the newly written data. It does not
have to be the same as the encoding of data in <code>file</code>. See
<code><a href="write_parquet.html">write_parquet()</a></code> for possible values.</p></dd>


<dt id="arg-row-groups">row_groups<a class="anchor" aria-label="anchor" href="#arg-row-groups"></a></dt>
<dd><p>Row groups of the new, extended Parquet file.
<code>append_parquet()</code> can only change the last existing row group, and
if <code>row_groups</code> is specified, it has respect this. I.e. if the
existing file has <code>n</code> rows, and the last row group starts at <code>k</code>
(<code>k &lt;= n</code>), then the first row group in <code>row_groups</code> that refers to
the new data must start at <code>k</code> or <code>n+1</code>.
(It is simpler to specify <code>num_rows_per_row_group</code> in <code>options</code>, see
<code><a href="parquet_options.html">parquet_options()</a></code> instead of <code>row_groups</code>. Only use <code>row_groups</code> if
you need complete control.)</p></dd>


<dt id="arg-options">options<a class="anchor" aria-label="anchor" href="#arg-options"></a></dt>
<dd><p>Nanoparquet options, for the new data, see
<code><a href="parquet_options.html">parquet_options()</a></code>. The <code>keep_row_groups</code> option also affects whether
<code>append_parquet()</code> overwrites existing row groups in <code>file</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="warning">Warning<a class="anchor" aria-label="anchor" href="#warning"></a></h2>


<p>This function is <strong>not</strong> atomic! If it is interrupted, it may leave
the file in a corrupt state. To work around this create a copy of the
original file, append the new data to the copy, and then rename the
new, extended file to the original one.</p>
    </div>
    <div class="section level2">
    <h2 id="about-row-groups">About row groups<a class="anchor" aria-label="anchor" href="#about-row-groups"></a></h2>


<p>A Parquet file may be partitioned into multiple row groups, and indeed
most large Parquet files are. <code>append_parquet()</code> is only able to update
the existing file along the row group boundaries. There are two
possibilities:</p><ul><li><p><code>append_parquet()</code> keeps all existing row groups in <code>file</code>, and
creates new row groups for the new data. This mode can be forced by
the <code>keep_row_groups</code> option in <code>options</code>, see <code><a href="parquet_options.html">parquet_options()</a></code>.</p></li>
<li><p>Alternatively, <code>write_parquet</code> will overwrite the <em>last</em> row group in
file, with its existing contents plus the (beginning of) the new data.
This mode makes more sense if the last row group is small, because
many small row groups are inefficient.</p></li>
</ul><p>By default <code>append_parquet</code> chooses between the two modes automatically,
aiming to create row groups with at least <code>num_rows_per_row_group</code>
(see <code><a href="parquet_options.html">parquet_options()</a></code>) rows. You can customize this behavior with
the <code>keep_row_groups</code> options and the <code>row_groups</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="write_parquet.html">write_parquet()</a></code>.</p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gaborcsardi" class="external-link">Gábor Csárdi</a>, Hannes Mühleisen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

  </div></footer></body></html>

